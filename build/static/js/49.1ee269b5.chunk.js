"use strict";(self.webpackChunksommelier=self.webpackChunksommelier||[]).push([[49],{9049:(e,t,a)=>{a.r(t),a.d(t,{default:()=>J});var s=a(9950),o=a(5664),l=a(2515),r=a(8858),c=a(2772),n=a(3386),i=a.n(n),d=(a(6552),a(1753)),h=a(8341),m=a(756),g=a(4520),p=a(2920),u=a(9107),y=a(2576),x=a(8469),S=a(9666),f=a(4269),k=a(5604),v=a(4414);class b extends s.Component{constructor(){super(...arguments),this.state={postal:""},this.handleSubmit=async e=>{e.preventDefault();const{stripe:t,elements:a,data:s}=this.props,o=a.getElement(k.CardNumberElement),{error:l,paymentMethod:r}=await t.createPaymentMethod({type:"card",card:o});if(l)console.log(l);else{s.data.handlePaymentProcessing(!0);const{id:e}=r;x.A.post(d.hW,{token:s.data.user.data.auth_token,id:e,amount:100*s.data.total,currency:localStorage.getItem("currencyId"),payment_method_types:["card"]}).then((e=>{console.log("STRIPE DATA",e.data);const{client_secret:a}=e.data;console.log(a),t.confirmCardPayment(a).then((e=>{e.paymentIntent&&"succeeded"===e.paymentIntent.status?(console.log("Payment successful!!!"),s.data.placeOrder("","STRIPE")):(console.log("Something went wrong..."),s.data.handlePaymentProcessing(!1))})).catch((function(e){console.log(e)}))})).catch((function(e){s.data.handlePaymentProcessing(!1),console.log(e)}))}}}render(){const{stripe:e,data:t}=this.props;return(0,v.jsx)(s.Fragment,{children:(0,v.jsxs)("form",{onSubmit:this.handleSubmit,children:[(0,v.jsx)("label",{htmlFor:"cardNumber",children:localStorage.getItem("checkoutCardNumber")}),(0,v.jsx)(k.CardNumberElement,{id:"cardNumber"}),(0,v.jsx)("label",{htmlFor:"expiry",children:localStorage.getItem("checkoutCardExpiration")}),(0,v.jsx)(k.CardExpiryElement,{id:"expiry"}),(0,v.jsx)("label",{htmlFor:"cvc",children:localStorage.getItem("checkoutCardCvv")}),(0,v.jsx)(k.CardCvcElement,{id:"cvc"}),"true"===localStorage.getItem("stripeCheckoutPostalCode")&&(0,v.jsxs)(s.Fragment,{children:[(0,v.jsx)("label",{htmlFor:"postal",children:localStorage.getItem("checkoutCardPostalCode")}),(0,v.jsx)("input",{id:"postal",required:!0,value:this.state.postal,className:"form-control StripeElement",onChange:e=>{this.setState({postal:e.target.value})}})]}),(0,v.jsxs)("button",{type:"submit",disabled:!e,className:"btn stripe-pay-btn",children:[localStorage.getItem("checkoutPayText")," ","left"===localStorage.getItem("currencySymbolAlign")&&localStorage.getItem("currencyFormat"),t.data.total,"right"===localStorage.getItem("currencySymbolAlign")&&localStorage.getItem("currencyFormat")]})]})})}}const _=e=>(0,v.jsx)(s.Fragment,{children:(0,v.jsx)(k.ElementsConsumer,{children:t=>{let{stripe:a,elements:s}=t;return(0,v.jsx)(b,{stripe:a,elements:s,data:e})}})}),j=(0,f.c)(localStorage.getItem("stripePublicKey"),{locale:localStorage.getItem("stripeLocale")}),I=e=>(0,v.jsx)(k.Elements,{stripe:j,children:(0,v.jsx)(_,{data:e})}),w={classes:{base:"StripeElementIdeal",focus:"StripeElementIdeal--focus"},style:{base:{padding:"10px 8px",fontSize:"15px",color:"#5f5f5f",letterSpacing:"0.025em","::placeholder":{color:"#aab7c4"}},invalid:{color:"#9e2146"}}};class C extends s.Component{constructor(){super(...arguments),this.state={name:"",errorMessage:null,paymentMethod:null,client_secret:""},this.handleSubmit=async e=>{e.preventDefault();const{stripe:t,elements:a,data:s}=this.props,{error:o,paymentMethod:l}=await t.createPaymentMethod({type:"ideal",ideal:a.getElement(k.IdealBankElement)});if(!o){s.data.handlePaymentProcessing(!0);const{id:e}=l;x.A.post(d.hW,{token:s.data.user.data.auth_token,id:e,amount:100*s.data.total,currency:"eur",payment_method_types:["ideal"]}).then((e=>{new Promise((e=>{s.data.placeOrder("","STRIPE",!0),e("Order Placed")})).then((()=>{this.setState({client_secret:e.data.client_secret})}))})).catch((function(e){s.data.handlePaymentProcessing(!1),console.log(e)}))}},this.handleConfirmIdealPayment=e=>{const{stripe:t,elements:a}=this.props;if(""!==this.state.client_secret){const{error:s}=t.confirmIdealPayment(this.state.client_secret,{payment_method:{ideal:a.getElement(k.IdealBankElement),billing_details:{name:this.state.name}},return_url:d.CW+"?order_id="+e.data.id});s&&console.log(s.message)}}}componentWillReceiveProps(e){this.props.data.data.checkout!==e.data.data.checkout&&(console.log("Order Placed"),this.handleConfirmIdealPayment(e.data.data.checkout))}render(){const{stripe:e,data:t}=this.props;return(0,v.jsx)(s.Fragment,{children:(0,v.jsxs)("form",{onSubmit:this.handleSubmit,children:[(0,v.jsx)("label",{htmlFor:"name",children:localStorage.getItem("checkoutCardFullname")}),(0,v.jsx)("input",{id:"name",required:!0,className:"form-control StripeElement",onChange:e=>{this.setState({name:e.target.value})}}),(0,v.jsx)("label",{htmlFor:"ideal",children:localStorage.getItem("checkoutIdealSelectBankText")}),(0,v.jsx)(k.IdealBankElement,{id:"ideal",options:w}),(0,v.jsxs)("button",{type:"submit",disabled:!e,className:"btn stripe-pay-btn",children:[localStorage.getItem("checkoutPayText")," ","left"===localStorage.getItem("currencySymbolAlign")&&localStorage.getItem("currencyFormat"),t.data.total,"right"===localStorage.getItem("currencySymbolAlign")&&localStorage.getItem("currencyFormat")]})]})})}}const N=e=>(0,v.jsx)(k.ElementsConsumer,{children:t=>{let{stripe:a,elements:s}=t;return(0,v.jsx)(C,{stripe:a,elements:s,data:e})}}),P=(0,f.c)(localStorage.getItem("stripePublicKey"),{locale:localStorage.getItem("stripeLocale")}),F=(0,h.Ng)((e=>({checkout:e.checkout.checkout})),{})((e=>(0,v.jsx)(k.Elements,{stripe:P,children:(0,v.jsx)(N,{data:e})}))),T={accountHolderType:"individual",classes:{base:"StripeElementFpx",focus:"StripeElementFpx--focus"},style:{base:{padding:"10px 8px",fontSize:"15px",color:"#5f5f5f",letterSpacing:"0.025em","::placeholder":{color:"#aab7c4"}},invalid:{color:"#9e2146"}}};class A extends s.Component{constructor(){super(...arguments),this.state={name:"",errorMessage:null,paymentMethod:null,client_secret:""},this.handleSubmit=async e=>{e.preventDefault();const{stripe:t,elements:a,data:s}=this.props,{error:o,paymentMethod:l}=await t.createPaymentMethod({type:"fpx",fpx:a.getElement(k.FpxBankElement)});if(!o){s.data.handlePaymentProcessing(!0);const{id:e}=l;x.A.post(d.hW,{token:s.data.user.data.auth_token,id:e,amount:100*s.data.total,currency:"myr",payment_method_types:["fpx"]}).then((e=>{new Promise((e=>{s.data.placeOrder("","STRIPE",!0),e("Order Placed")})).then((()=>{this.setState({client_secret:e.data.client_secret})}))})).catch((function(e){s.data.handlePaymentProcessing(!1),console.log(e)}))}},this.handleConfirmFpxPayment=e=>{const{stripe:t,elements:a}=this.props;if(""!==this.state.client_secret){const{error:s}=t.confirmFpxPayment(this.state.client_secret,{payment_method:{fpx:a.getElement(k.FpxBankElement),billing_details:{name:this.state.name}},return_url:d.CW+"?order_id="+e.data.id});s&&console.log(s.message)}}}componentWillReceiveProps(e){this.props.data.data.checkout!==e.data.data.checkout&&(console.log("Order Placed"),this.handleConfirmFpxPayment(e.data.data.checkout))}render(){const{stripe:e,data:t}=this.props;return(0,v.jsx)(s.Fragment,{children:(0,v.jsxs)("form",{onSubmit:this.handleSubmit,children:[(0,v.jsx)("label",{htmlFor:"name",children:localStorage.getItem("checkoutCardFullname")}),(0,v.jsx)("input",{id:"name",required:!0,className:"form-control StripeElement",onChange:e=>{this.setState({name:e.target.value})}}),(0,v.jsx)("label",{htmlFor:"fpx",children:localStorage.getItem("checkoutFpxSelectBankText")}),(0,v.jsx)(k.FpxBankElement,{accountHolderType:"individual",id:"fpx",options:T}),(0,v.jsxs)("button",{type:"submit",disabled:!e,className:"btn stripe-pay-btn",children:[localStorage.getItem("checkoutPayText")," ","left"===localStorage.getItem("currencySymbolAlign")&&localStorage.getItem("currencyFormat"),t.data.total,"right"===localStorage.getItem("currencySymbolAlign")&&localStorage.getItem("currencyFormat")]})]})})}}const E=e=>(0,v.jsx)(k.ElementsConsumer,{children:t=>{let{stripe:a,elements:s}=t;return(0,v.jsx)(A,{stripe:a,elements:s,data:e})}}),O=(0,f.c)(localStorage.getItem("stripePublicKey"),{locale:localStorage.getItem("stripeLocale")}),M=(0,h.Ng)((e=>({checkout:e.checkout.checkout})),{})((e=>(0,v.jsx)(k.Elements,{stripe:O,children:(0,v.jsx)(E,{data:e})})));var W=a(8170),B=a(8429),L=a(9515);class z extends s.Component{constructor(){super(...arguments),this.getCountryId=()=>{switch(localStorage.getItem("currencyId")){case"KES":return"KE";case"GHS":return"GH";case"ZAR":return"ZA";case"TZS":return"TZ";default:return"NG"}}}render(){const{total:e,user:t,placeOrder:a,reset:o}=this.props,l={...{public_key:localStorage.getItem("flutterwavePublicKey"),tx_ref:Date.now(),amount:e,currency:localStorage.getItem("currencyId"),country:this.getCountryId(),payment_options:"card,account,ussd,qr,mpesa,mobilemoneyghana,mobilemoneyuganda,mobilemoneyrwanda,mobilemoneyzambia,mobilemoneytanzania,barter,bank transfer,wechat",customer:{email:t.data.email,phonenumber:t.data.phone,name:t.data.name},customizations:{logo:window.location.origin+"/assets/img/favicons/"+localStorage.getItem("favicon-96x96")}},text:"Pay with Flutterwave",className:"flutterwave-btn",callback:e=>{console.log(e),"successful"===e.status&&a("","FLUTTERWAVE"),(0,L.cT)()},onClose:()=>{console.log("flutterwave closed."),o()}};return(0,v.jsx)(s.Fragment,{children:(0,v.jsx)(L.Mz,{...l})})}}const D=z;var G=a(1243),R=a.n(G);class K extends s.Component{constructor(){var e;super(...arguments),e=this,this.state={payment_gateway_loading:!0,loading:!1,stripe_opened:!1,delivery_charges:0,error:!1,razorpay_opened:!1,razorpay_success:!1,canPayPartialWithWallet:!1,walletChecked:!1,canPayFullWithWallet:!1,distance:0,placeOrderError:!1,errorMessage:"",payWithStripeCard:!1,payWithStripeIdeal:!1,payWithStripeFpx:!1,paymongoCCNumber:"",paymongoCCExp:"",paymongoCCCvv:"",showPaymongoForm:!1,paymongoNavigate:"",paymongo_processing:!1,cashChange:"",regexp:/^[0-9\b]+$/,showCod:!1},this.__doesRestaurantOperatesAtThisLocation=e=>{const{user:t}=this.props;if(t.success){let a=this;if("true"===localStorage.getItem("enGDMA"))"DELIVERY"===localStorage.getItem("userSelected")&&(this.props.handleProcessDistanceCalcLoading(!0),(0,y.A)(e.longitude,e.latitude,t.data.default_address.longitude,t.data.default_address.latitude,this.props.google,(function(e){"DYNAMIC"===a.props.restaurant_info.delivery_charge_type&&a.setState({distance:e},(()=>{a.calculateDynamicDeliveryCharge()})),a.props.handleProcessDistanceCalcLoading(!1)})));else if("DELIVERY"===localStorage.getItem("userSelected")){const a=(0,u.g)(e.longitude,e.latitude,t.data.default_address.longitude,t.data.default_address.latitude);"DYNAMIC"===this.props.restaurant_info.delivery_charge_type&&this.setState({distance:a},(()=>{this.calculateDynamicDeliveryCharge()}))}}},this.calculateDynamicDeliveryCharge=()=>{const{restaurant_info:e}=this.props,t=this.state.distance;let a=0;if(t>e.base_delivery_distance){const s=(t-e.base_delivery_distance)/e.extra_delivery_distance*e.extra_delivery_charge;let o=parseFloat(e.base_delivery_charge)+parseFloat(s);"true"===localStorage.getItem("enDelChrRnd")&&(o=Math.ceil(o)),a=o,console.log("dynamic: "+a)}else a=e.base_delivery_charge,console.log("fixed: "+a);parseFloat(e.free_delivery_subtotal)>0&&parseFloat(this.props.cartTotal.totalPrice)>=parseFloat(e.free_delivery_subtotal)?(console.log("Free Delivery \ud83d\ude0d"),this.setState({delivery_charges:0})):this.setState({delivery_charges:a})},this.onOpened=()=>{this.setState({stripe_opened:!0})},this.onToken=e=>{this.__placeOrder(e,"STRIPE")},this.onSuccess=e=>{this.__placeOrder("","PAYPAL")},this.onCancel=e=>{console.log("Paypal Payment Canceled")},this.onError=e=>{console.log("Error!")},this.callback=e=>{if("success"===e.status){const t=e.reference,a="PAYSTACK";this.__placeOrder(t,a)}else console.log(e)},this.close=()=>{console.log("PayStack Payment Closed")},this.getReference=()=>{let e="",t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-.=";for(let a=0;a<15;a++)e+=t.charAt(Math.floor(65*Math.random()));return e},this.__placeOrder=function(t,a){let s=arguments.length>2&&void 0!==arguments[2]&&arguments[2];document.getElementById("checkoutNavPageTitle")&&document.getElementById("checkoutNavPageTitle").remove();let o=document.getElementsByClassName("paymentGatewayBlock");for(let e=0;e<o.length;e++)o[e].classList.add("no-click");let l=null;console.log("cart_tips",JSON.parse(localStorage.getItem("cart_tips"))),null!=JSON.parse(localStorage.getItem("cart_tips"))&&(l=JSON.parse(localStorage.getItem("cart_tips")).value);const{user:r,cartProducts:c,coupon:n,cartTotal:i}=e.props;if(r.success){"SELFPICKUP"===localStorage.getItem("userSelected")?e.props.placeOrder(r,c,n.success?n:null,JSON.parse(localStorage.getItem("userSetAddress")),localStorage.getItem("orderComment"),i,a,t,2,e.state.walletChecked,parseFloat(e.state.distance),s,null,null).then((t=>{t&&(t.success||(e.setState({placeOrderError:!0,errorMessage:t.message}),429===t.status&&e.setState({errorMessage:localStorage.getItem("tooManyApiCallMessage")}),e.resetPage()))})):e.props.placeOrder(r,c,n.success?n:null,JSON.parse(localStorage.getItem("userSetAddress")),localStorage.getItem("orderComment"),i,a,t,1,e.state.walletChecked,parseFloat(e.state.distance),s,l,e.state.cashChange).then((t=>{t&&(console.log("Came here"),console.log("THIS",t),401===t.status?(e.setState({placeOrderError:!0,errorMessage:localStorage.getItem("userInActiveMessage")}),e.resetPage()):t.success||(e.setState({placeOrderError:!0,errorMessage:t.message}),429===t.status&&e.setState({errorMessage:localStorage.getItem("tooManyApiCallMessage")}),e.resetPage()))}));const o=document.getElementById("progressBar");o.classList.remove("hidden");let h=0;var d=setInterval((function(){h>100&&clearInterval(d),h+=1,o.style.width=h+"%"}),20);document.getElementById("checkoutMessageOnProcess").classList.remove("hidden");document.getElementById("checkoutMessageOnIdle").classList.add("hidden"),e.setState({stripe_opened:!1})}},this.resetPage=()=>{const e=document.getElementById("progressBar");e.classList.add("hidden"),setTimeout((()=>{e.style.width="0%"}),2200);let t=document.getElementsByClassName("paymentGatewayBlock");for(let a=0;a<t.length;a++)t[a].classList.remove("no-click");document.getElementById("checkoutMessageOnProcess").classList.add("hidden");document.getElementById("checkoutMessageOnIdle").classList.remove("hidden")},this.getTotalAfterCalculation=()=>{const{coupon:e,restaurant_info:t,user:a}=this.props;var s=JSON.parse(localStorage.getItem("cart_tips"));const o=this.props.cartTotal.totalPrice;let l=0;if(e.code)if("PERCENTAGE"===e.discount_type){let a=(0,m.$)(e.discount/100*parseFloat(o));e.max_discount&&parseFloat(a)>=e.max_discount&&(a=e.max_discount),e.appliedAmount=a,l=(0,m.$)((0,m.$)(parseFloat(o)-a+parseFloat(t.restaurant_charges||0)+parseFloat(this.state.delivery_charges||0)))}else l=(0,m.$)(parseFloat(o)-(parseFloat(e.discount)||0)+((parseFloat(t.restaurant_charges)||0)+(parseFloat(this.state.delivery_charges)||0)));else l=(0,m.$)(parseFloat(o)+parseFloat(t.restaurant_charges||0)+parseFloat(this.state.delivery_charges||0));return"true"===localStorage.getItem("taxApplicable")?(l=(0,m.$)(parseFloat(parseFloat(l)+parseFloat(parseFloat(localStorage.getItem("taxPercentage"))/100)*l)),this.state.walletChecked&&a.data.wallet_balance<l&&(l-=a.data.wallet_balance)):this.state.walletChecked&&a.data.wallet_balance<l&&(l-=a.data.wallet_balance),s&&s.value>0&&(l=parseFloat(l)+parseFloat(s.value)),(0,m.$)(l)},this.__handleKhaltiPayment=()=>{this.props.handleLoading(!0);var e=this;let t={publicKey:localStorage.getItem("khaltiPublicKey"),productIdentity:localStorage.getItem("storeName"),productName:localStorage.getItem("storeName"),productUrl:localStorage.getItem("storeUrl"),eventHandler:{onSuccess(t){console.log(t),e.__handleKhaltiPaymentSuccess(t)},onError(e){console.log(e),alert("Something went wrong. Please try again.")},onClose(){e.props.handleLoading(!1)}}},a=new(R())(t);const s=100*this.getTotalAfterCalculation();a.show({amount:s})},this.__handleKhaltiPaymentSuccess=e=>{x.A.get(d.nE,{params:{token:e.token,amount:e.amount}}).then((e=>{console.log("Verification Response: ",e),e.data.success&&(console.log("success.. place order now"),this.__placeOrder(e.data.idx,"KHALTI"))})).catch((function(e){alert("Something went wrong."),this.props.handleLoading(!1)}))},this.__handleRazorPay=(e,t)=>{let a=this;this.setState({razorpay_opened:!0}),x.A.post(d.vh,{order_id:e}).then((s=>{if(console.log(s),s.data.razorpay_success){const o={key:localStorage.getItem("razorpayKeyId"),name:localStorage.getItem("storeName"),currency:localStorage.getItem("currencyId"),order_id:s.data.response.id,handler(s){x.A.post(d.Dj,{order_id:e,razorpay_order_id:s.razorpay_order_id,razorpay_payment_id:s.razorpay_payment_id,razorpay_signature:s.razorpay_signature}).then((e=>{e&&e.data&&e.data.success&&a.context.router.history.push("/running-order/"+t)}))},modal:{ondismiss:function(){a.setState({razorpay_opened:!1,razorpay_success:!1}),a.context.router.history.push("/my-orders")}},prefill:{name:this.props.user.data.name,email:this.props.user.data.email,contact:this.props.user.data.phone}};new window.Razorpay(o).open()}})).catch((function(e){console.log(e)}))},this.handleInput=e=>{const{name:t,value:a}=e.target;this.setState({[t]:a})},this.__showPaymongoForm=()=>{this.setState({showPaymongoForm:!0})},this.handlePaymongo=e=>{e.preventDefault();const t=this.state.paymongoCCNumber,a=this.state.paymongoCCExp,s=this.state.paymongoCCCvv;if(""===t||""===a||""===s)this.setState({placeOrderError:!0,errorMessage:"Please enter credit card details."});else{this.props.handleLoading(!0),this.setState({paymongo_processing:!0});let e=this;this.setState({paymongo_opened:!0,showPaymongoForm:!1,placeOrderError:!1,errorMessage:""});const o=(0,m.$)(parseFloat(this.getTotalAfterCalculation())),l="PAYMONGO";x.A.post(d.cD,{amount:o,name:this.props.user.data.name,email:this.props.user.data.email,phone:this.props.user.data.phone,ccNum:t,ccExp:a,ccCvv:s}).then((t=>{console.log(t),t.data.paymongo_success&&("succeeded"===t.data.status?(e.setState({paymongo_opened:!1,paymongo_success:!0}),this.__placeOrder(t.data.token,l,!1)):"awaiting_next_action"===t.data.status?(console.log("3d secure"),e.setState({paymongo_opened:!1,paymongo_success:!0,paymongoNavigate:t.data.Navigate_url}),this.__placeOrder(t.data.token,l,!0)):(this.props.handleLoading(!1),e.setState({paymongo_processing:!1,paymongo_opened:!0,paymongo_success:!1,placeOrderError:!0,errorMessage:"Payment failed: "+t.data.error})))})).catch((function(e){console.log(e)}))}},this.handlePayWithStripeCardToggle=e=>{this.setState({payWithStripeCard:!this.state.payWithStripeCard},(()=>{this.state.payWithStripeCard?(this.refs.payWithStripeCardToggle.classList.add("stripe-toggle-active"),this.refs.payWithStripeCardToggle.scrollIntoView({behavior:"instant",block:"start"})):this.refs.payWithStripeCardToggle.classList.remove("stripe-toggle-active")}))},this.handlePayWithStripeIdealToggle=e=>{this.setState({payWithStripeIdeal:!this.state.payWithStripeIdeal},(()=>{this.state.payWithStripeIdeal?(this.refs.payWithStripeIdealToggle.classList.add("stripe-toggle-active"),this.refs.payWithStripeIdealToggle.scrollIntoView({behavior:"instant",block:"start"})):this.refs.payWithStripeIdealToggle.classList.remove("stripe-toggle-active")}))},this.handlePayWithStripeFpxToggle=e=>{this.setState({payWithStripeFpx:!this.state.payWithStripeFpx},(()=>{this.state.payWithStripeFpx?(this.refs.payWithStripeFpxToggle.classList.add("stripe-toggle-active"),this.refs.payWithStripeFpxToggle.scrollIntoView({behavior:"instant",block:"start"})):this.refs.payWithStripeFpxToggle.classList.remove("stripe-toggle-active")}))},this.handlePaymentGatewayNavigate=e=>{console.log("I am here"),console.log("Placed order",this.props.checkout.id);const t=e+"&order_id="+this.props.checkout.id;window.location.replace(t)},this.__processFlutterWave=()=>{let e=document.getElementsByClassName("paymentGatewayBlock");for(let t=0;t<e.length;t++)e[t].classList.add("no-click");document.getElementsByClassName("flutterwave-btn")[0].click()},this.__showCashChangeBlock=e=>{this.refs.cashAmountBlock.classList.remove("hidden");let t=document.getElementsByClassName("paymentGatewayBlock");for(let a=0;a<t.length;a++)t[a].classList.add("hidden");this.refs.paymentListTitle.innerHTML=localStorage.getItem("cashChangeTitle")},this.__handleCashInput=e=>{let t=e.target.value;(""===t||this.state.regexp.test(t))&&t.length<=8&&this.setState({[e.target.name]:t})},this.__handleCashInputConfirm=e=>{e.target.disabled=!0,this.__placeOrder("","COD")}}componentDidMount(){const{user:e}=this.props;null!==localStorage.getItem("activeRestaurant")&&this.props.getRestaurantInfoById(localStorage.getItem("activeRestaurant")).then((e=>{e&&e.payload.id&&this.__doesRestaurantOperatesAtThisLocation(e.payload)})),e.success&&this.props.updateUserInfo(e.data.id,e.data.auth_token,null),"SELFPICKUP"===localStorage.getItem("userSelected")?this.setState({delivery_charges:0}):parseFloat(this.props.restaurant_info.free_delivery_subtotal)>0&&parseFloat(this.props.cartTotal.totalPrice)>=parseFloat(this.props.restaurant_info.free_delivery_subtotal)?(console.log("Free Delivery \ud83d\ude0d"),this.setState({delivery_charges:0})):this.setState({delivery_charges:this.props.restaurant_info.delivery_charges}),"SELFPICKUP"===localStorage.getItem("userSelected")?"true"===localStorage.getItem("enCODonSF")?this.setState({showCod:!0}):this.setState({showCod:!1}):this.setState({showCod:!0})}componentWillReceiveProps(e){if(e.gatewayStatus&&this.setState({payment_gateway_loading:!1}),e.checkout!==this.props.checkout){if(localStorage.removeItem("appliedCoupon"),"PAYMONGO"===e.checkout.data.payment_mode&&""!==this.state.paymongoNavigate)return window.location=this.state.paymongoNavigate,null;if("MERCADOPAGO"===e.checkout.data.payment_mode)return window.location=d.QT+"/"+e.checkout.data.id,null;if(8!==e.checkout.data.orderstatus_id&&this.context.router.history.push("/running-order/"+e.checkout.data.unique_order_id),"PAYTM"===e.checkout.data.payment_mode)return window.location=d.dS+"/"+e.checkout.data.id,null;if("RAZORPAY"===e.checkout.data.payment_mode)return console.log(e.checkout),"FoodomaaAndroidWebViewUA"===navigator.userAgent?"undefined"!==window.Android&&window.Android.startRazorpaySdkProcess(e.checkout.data.id,e.checkout.data.unique_order_id,e.user.data.name,e.user.data.email,e.user.data.phone):this.__handleRazorPay(e.checkout.data.id,e.checkout.data.unique_order_id),null}console.log("Google Loading: "+e.googleLoadingStatus),!1===e.googleLoadingStatus&&(e.user.data.wallet_balance>0&&e.user.data.wallet_balance<parseFloat(this.getTotalAfterCalculation())&&this.setState({canPayPartialWithWallet:!0,canPayFullWithWallet:!1}),e.user.data.wallet_balance>0&&e.user.data.wallet_balance>=parseFloat(this.getTotalAfterCalculation())&&(console.log("Inside:"+parseFloat(this.getTotalAfterCalculation())),this.setState({canPayFullWithWallet:!0,canPayPartialWithWallet:!1})))}render(){const e={sandbox:localStorage.getItem("paypalSandboxKey"),production:localStorage.getItem("paypalProductionKey")};return this.props.toPay((0,m.$)(parseFloat(this.getTotalAfterCalculation()))),this.props.restaurant_info&&!this.props.restaurant_info.is_active?(console.log("store is closed"),(0,v.jsx)(B.C5,{to:"/cart"})):(0,v.jsxs)(s.Fragment,{children:[this.state.placeOrderError&&(0,v.jsx)("div",{className:"auth-error ongoing-payment",children:(0,v.jsx)("div",{className:"error-shake",children:this.state.errorMessage})}),this.props.paymentgateways.some((e=>"Razorpay"===e.name))&&(0,v.jsx)(c.m,{children:(0,v.jsx)("script",{src:"https://checkout.razorpay.com/v1/checkout.js"})}),(this.state.stripe_opened||this.state.razorpay_opened)&&(0,v.jsxs)(s.Fragment,{children:[(0,v.jsx)("div",{className:"height-80 overlay-loading ongoing-payment-spin",children:(0,v.jsx)("div",{className:"spin-load"})}),(0,v.jsx)("div",{className:"auth-error ongoing-payment",children:(0,v.jsx)("div",{className:"error-shake",children:localStorage.getItem("checkoutPaymentInProcess")})})]}),(0,v.jsx)("div",{className:"col-12 mb-50",children:this.state.payment_gateway_loading?(0,v.jsxs)("div",{className:"row",children:[(0,v.jsx)("div",{className:"col-12",children:(0,v.jsx)("div",{className:"block block-link-shadow text-left shadow-light",children:(0,v.jsx)("div",{className:"block-content block-content-full clearfix py-3 payment-select-block",children:(0,v.jsxs)(r.Ay,{height:70,width:window.innerWidth,speed:1.2,primaryColor:"#f3f3f3",secondaryColor:"#ecebeb",children:[(0,v.jsx)("rect",{x:"320",y:"10",rx:"4",ry:"4",width:"55",height:"55"}),(0,v.jsx)("rect",{x:"0",y:"10",rx:"0",ry:"0",width:"85",height:"20"}),(0,v.jsx)("rect",{x:"0",y:"40",rx:"0",ry:"0",width:"190",height:"18"})]})})})}),(0,v.jsx)("div",{className:"col-12",children:(0,v.jsx)("div",{className:"block block-link-shadow text-left shadow-light",children:(0,v.jsx)("div",{className:"block-content block-content-full clearfix py-3 payment-select-block",children:(0,v.jsxs)(r.Ay,{height:70,width:window.innerWidth,speed:1.2,primaryColor:"#f3f3f3",secondaryColor:"#ecebeb",children:[(0,v.jsx)("rect",{x:"320",y:"10",rx:"4",ry:"4",width:"55",height:"55"}),(0,v.jsx)("rect",{x:"0",y:"10",rx:"0",ry:"0",width:"85",height:"20"}),(0,v.jsx)("rect",{x:"0",y:"40",rx:"0",ry:"0",width:"190",height:"18"})]})})})})]}):(0,v.jsx)(s.Fragment,{children:(0,v.jsxs)("div",{className:"row",children:[this.state.canPayPartialWithWallet&&(0,v.jsx)(s.Fragment,{children:(0,v.jsxs)("div",{className:"col-12",onClick:()=>this.setState({walletChecked:!this.state.walletChecked}),children:[(0,v.jsx)("div",{className:"block block-link-shadow text-left shadow-light",children:(0,v.jsxs)("div",{className:"block-content block-content-full clearfix py-3 payment-select-block",children:[(0,v.jsx)("div",{className:"float-right mt-10",children:(0,v.jsx)("img",{src:"/assets/img/various/wallet.png",alt:localStorage.getItem("walletName"),className:"img-fluid"})}),(0,v.jsx)("input",{type:"checkbox",name:"walletcheckbox",defaultChecked:this.props.walletChecked,className:"wallet-checkbox"}),(0,v.jsxs)("div",{className:"font-size-h3 font-w600",children:[this.state.walletChecked&&(0,v.jsx)("i",{className:"si si-check mr-2",style:{color:localStorage.getItem("cartColorBg"),fontWeight:"900"}}),localStorage.getItem("walletName"),":"," ",(0,v.jsxs)("span",{style:{color:localStorage.getItem("storeColor")},children:["left"===localStorage.getItem("currencySymbolAlign")&&localStorage.getItem("currencyFormat"),this.props.user.data.wallet_balance,"right"===localStorage.getItem("currencySymbolAlign")&&localStorage.getItem("currencyFormat")]})]}),(0,v.jsx)("div",{className:"font-size-sm font-w600 text-muted",children:this.state.walletChecked?(0,v.jsxs)(s.Fragment,{children:[(0,v.jsxs)("span",{style:{color:localStorage.getItem("storeColor")},children:[" ","left"===localStorage.getItem("currencySymbolAlign")&&localStorage.getItem("currencyFormat"),this.props.user.data.wallet_balance," ","right"===localStorage.getItem("currencySymbolAlign")&&localStorage.getItem("currencyFormat")]})," ",localStorage.getItem("willbeDeductedText")," ","left"===localStorage.getItem("currencySymbolAlign")&&localStorage.getItem("currencyFormat"),this.props.user.data.wallet_balance,"right"===localStorage.getItem("currencySymbolAlign")&&localStorage.getItem("currencyFormat")]}):(0,v.jsxs)(s.Fragment,{children:[(0,v.jsx)("span",{children:localStorage.getItem("payPartialWithWalletText")}),(0,v.jsx)("button",{className:"btn btn-redeem mt-2",style:{color:localStorage.getItem("cartColorBg"),borderColor:localStorage.getItem("cartColorBg")},children:localStorage.getItem("walletRedeemBtnText")})]})})]})}),(0,v.jsx)("hr",{className:"mb-4"})]})}),(0,v.jsx)("hr",{}),(0,v.jsx)("div",{className:"col-12 text-center mb-0 mt-4",children:(0,v.jsx)("h4",{className:"text-muted",ref:"paymentListTitle",children:localStorage.getItem("checkoutPaymentListTitle")})}),this.state.canPayFullWithWallet&&(0,v.jsxs)(s.Fragment,{children:[(0,v.jsxs)("div",{className:"col-12 paymentGatewayBlock",onClick:()=>this.__placeOrder("","WALLET"),children:[(0,v.jsx)("p",{className:"mb-1"}),(0,v.jsx)("div",{className:"block block-link-shadow text-left shadow-light",children:(0,v.jsxs)("div",{className:"block-content block-content-full clearfix py-3 payment-select-block",children:[(0,v.jsx)("div",{className:"float-right mt-10",children:(0,v.jsx)("img",{src:"/assets/img/various/wallet.png",alt:localStorage.getItem("walletName"),className:"img-fluid"})}),(0,v.jsx)("div",{className:"font-size-h3 font-w600",children:localStorage.getItem("walletName")}),(0,v.jsxs)("div",{className:"font-size-sm font-w600 text-muted",children:[localStorage.getItem("payFullWithWalletText"),(0,v.jsx)("br",{}),(0,v.jsxs)("span",{style:{color:localStorage.getItem("storeColor")},children:["left"===localStorage.getItem("currencySymbolAlign")&&localStorage.getItem("currencyFormat"),parseFloat(this.getTotalAfterCalculation()),"right"===localStorage.getItem("currencySymbolAlign")&&localStorage.getItem("currencyFormat")]})," ",localStorage.getItem("willbeDeductedText")," ","left"===localStorage.getItem("currencySymbolAlign")&&localStorage.getItem("currencyFormat"),this.props.user.data.wallet_balance,"right"===localStorage.getItem("currencySymbolAlign")&&localStorage.getItem("currencyFormat")]})]})})]}),(0,v.jsx)("hr",{})]}),(0,v.jsx)("div",{className:"col-12",children:"true"===localStorage.getItem("stripeAcceptIdealPayment")&&(0,v.jsxs)(s.Fragment,{children:[(0,v.jsx)("div",{className:"col-12 p-0",ref:"payWithStripeIdealToggle",onClick:this.handlePayWithStripeIdealToggle,children:(0,v.jsx)("div",{className:"block block-link-shadow text-left shadow-light",children:(0,v.jsxs)("div",{className:"block-content block-content-full clearfix py-3 payment-select-block",children:[(0,v.jsx)("div",{className:"float-right mt-10",children:(0,v.jsx)("img",{src:"/assets/img/various/ideal.png",alt:"stripe-ideal",className:"img-fluid",style:{width:"50px"}})}),(0,v.jsxs)("div",{className:"font-size-h3 font-w600",children:[localStorage.getItem("checkoutStripeIdealText"),(0,v.jsx)("div",{className:"font-size-sm font-w600 text-muted",children:localStorage.getItem("checkoutStripeIdealSubText")})]})]})})}),this.state.payWithStripeIdeal&&(0,v.jsx)("div",{className:"stripe-card-container",children:(0,v.jsx)(F,{user:this.props.user,total:(0,m.$)(parseFloat(this.getTotalAfterCalculation())),handlePaymentProcessing:this.props.handleLoading,placeOrder:this.__placeOrder,handlePaymentGatewayNavigate:this.handlePaymentGatewayNavigate,checkout:this.props.checkout})})]})}),(0,v.jsx)("div",{className:"col-12",children:"true"===localStorage.getItem("stripeAcceptFpxPayment")&&(0,v.jsxs)(s.Fragment,{children:[(0,v.jsx)("div",{className:"col-12 p-0",ref:"payWithStripeFpxToggle",onClick:this.handlePayWithStripeFpxToggle,children:(0,v.jsx)("div",{className:"block block-link-shadow text-left shadow-light",children:(0,v.jsxs)("div",{className:"block-content block-content-full clearfix py-3 payment-select-block",children:[(0,v.jsx)("div",{className:"float-right mt-10",children:(0,v.jsx)("img",{src:"/assets/img/various/fpx.png",alt:"stripe-fpx",className:"img-fluid",style:{width:"50px"}})}),(0,v.jsxs)("div",{className:"font-size-h3 font-w600",children:[localStorage.getItem("checkoutStripeFpxText"),(0,v.jsx)("div",{className:"font-size-sm font-w600 text-muted",children:localStorage.getItem("checkoutStripeFpxSubText")})]})]})})}),this.state.payWithStripeFpx&&(0,v.jsx)("div",{className:"stripe-card-container",children:(0,v.jsx)(M,{user:this.props.user,total:(0,m.$)(parseFloat(this.getTotalAfterCalculation())),handlePaymentProcessing:this.props.handleLoading,placeOrder:this.__placeOrder,handlePaymentGatewayNavigate:this.handlePaymentGatewayNavigate,checkout:this.props.checkout})})]})}),this.props.paymentgateways.map((t=>(0,v.jsxs)(s.Fragment,{children:["Stripe"===t.name&&(0,v.jsx)("div",{className:"col-12 paymentGatewayBlock stripe-gateway-block",children:(0,v.jsxs)(s.Fragment,{children:[(0,v.jsx)("div",{className:"col-12 p-0",ref:"payWithStripeCardToggle",onClick:this.handlePayWithStripeCardToggle,children:(0,v.jsx)("div",{className:"block block-link-shadow text-left shadow-light",children:(0,v.jsxs)("div",{className:"block-content block-content-full clearfix py-3 payment-select-block",children:[(0,v.jsx)("div",{className:"float-right mt-10",children:(0,v.jsx)("img",{src:"/assets/img/various/stripe.png",alt:t.name,className:"img-fluid"})}),(0,v.jsxs)("div",{className:"font-size-h3 font-w600",children:[localStorage.getItem("checkoutStripeText"),(0,v.jsx)("div",{className:"font-size-sm font-w600 text-muted",children:localStorage.getItem("checkoutStripeSubText")})]})]})})}),this.state.payWithStripeCard&&(0,v.jsx)("div",{className:"stripe-card-container",children:(0,v.jsx)(I,{user:this.props.user,total:(0,m.$)(parseFloat(this.getTotalAfterCalculation())),handlePaymentProcessing:this.props.handleLoading,placeOrder:this.__placeOrder})})]})}),this.state.showCod&&(0,v.jsx)(s.Fragment,{children:"COD"===t.name&&(0,v.jsx)(s.Fragment,{children:"true"===localStorage.getItem("showCashChange")?(0,v.jsxs)(s.Fragment,{children:[(0,v.jsx)("div",{className:"col-12 paymentGatewayBlock",onClick:()=>this.__showCashChangeBlock(),children:(0,v.jsx)("div",{className:"block block-link-shadow text-left shadow-light",children:(0,v.jsxs)("div",{className:"block-content block-content-full clearfix py-3 payment-select-block",children:[(0,v.jsx)("div",{className:"float-right mt-10",children:(0,v.jsx)("img",{src:"/assets/img/various/cod.png",alt:t.name,className:"img-fluid"})}),(0,v.jsx)("div",{className:"font-size-h3 font-w600",children:localStorage.getItem("checkoutCodText")}),(0,v.jsx)("div",{className:"font-size-sm font-w600 text-muted",children:localStorage.getItem("checkoutCodSubText")})]})})}),(0,v.jsx)("div",{className:"col-12 hidden",ref:"cashAmountBlock",children:(0,v.jsxs)("div",{className:"text-left",children:[(0,v.jsx)("input",{type:"tel",name:"cashChange",value:this.state.cashChange,className:"form-control cash-change-input",placeholder:localStorage.getItem("cashChangeInputPlaceholder"),onChange:this.__handleCashInput}),(0,v.jsx)("button",{className:"btn btn-main",style:{backgroundColor:localStorage.getItem("cartColorBg")},onClick:this.__handleCashInputConfirm,children:localStorage.getItem("cashChangeConfirmButton")}),(0,v.jsx)("p",{className:"pt-2",children:localStorage.getItem("cashChangeHelpText")})]})})]}):(0,v.jsx)("div",{className:"col-12 paymentGatewayBlock",onClick:()=>this.__placeOrder("","COD"),children:(0,v.jsx)("div",{className:"block block-link-shadow text-left shadow-light",children:(0,v.jsxs)("div",{className:"block-content block-content-full clearfix py-3 payment-select-block",children:[(0,v.jsx)("div",{className:"float-right mt-10",children:(0,v.jsx)("img",{src:"/assets/img/various/cod.png",alt:t.name,className:"img-fluid"})}),(0,v.jsx)("div",{className:"font-size-h3 font-w600",children:localStorage.getItem("checkoutCodText")}),(0,v.jsx)("div",{className:"font-size-sm font-w600 text-muted",children:localStorage.getItem("checkoutCodSubText")})]})})})})}),"Khalti"===t.name&&(0,v.jsx)("div",{className:"col-12 paymentGatewayBlock",onClick:()=>this.__handleKhaltiPayment(),children:(0,v.jsx)("div",{className:"block block-link-shadow text-left shadow-light",children:(0,v.jsxs)("div",{className:"block-content block-content-full clearfix py-3 payment-select-block",children:[(0,v.jsx)("div",{className:"float-right mt-10",children:(0,v.jsx)("img",{src:"/assets/img/various/khalti.png",alt:t.name,className:"img-fluid"})}),(0,v.jsx)("div",{className:"font-size-h3 font-w600",children:localStorage.getItem("checkoutKhaltiText")}),(0,v.jsx)("div",{className:"font-size-sm font-w600 text-muted",children:localStorage.getItem("checkoutKhaltiSubText")})]})})}),"Paytm"===t.name&&(0,v.jsx)("div",{className:"col-12 paymentGatewayBlock",onClick:()=>this.__placeOrder("","PAYTM"),children:(0,v.jsx)("div",{className:"block block-link-shadow text-left shadow-light",children:(0,v.jsxs)("div",{className:"block-content block-content-full clearfix py-3 payment-select-block",children:[(0,v.jsx)("div",{className:"float-right mt-10",children:(0,v.jsx)("img",{src:"/assets/img/various/paytm.png",alt:t.name,className:"img-fluid"})}),(0,v.jsx)("div",{className:"font-size-h3 font-w600",children:localStorage.getItem("checkoutPaytmText")}),(0,v.jsx)("div",{className:"font-size-sm font-w600 text-muted",children:localStorage.getItem("checkoutPaytmSubText")})]})})}),"Flutterwave"===t.name&&(0,v.jsxs)(s.Fragment,{children:[(0,v.jsx)(D,{user:this.props.user,total:(0,m.$)(parseFloat(this.getTotalAfterCalculation())),placeOrder:this.__placeOrder,reset:this.resetPage}),(0,v.jsx)("div",{className:"col-12 paymentGatewayBlock",onClick:()=>this.__processFlutterWave(),children:(0,v.jsx)("div",{className:"block block-link-shadow text-left shadow-light",children:(0,v.jsxs)("div",{className:"block-content block-content-full clearfix py-3 payment-select-block",children:[(0,v.jsx)("div",{className:"float-right mt-10",children:(0,v.jsx)("img",{src:"/assets/img/various/flutterwave.png",alt:t.name,className:"img-fluid"})}),(0,v.jsx)("div",{className:"font-size-h3 font-w600",children:localStorage.getItem("checkoutFlutterwaveText")}),(0,v.jsx)("div",{className:"font-size-sm font-w600 text-muted",children:localStorage.getItem("checkoutFlutterwaveSubText")})]})})})]}),"Razorpay"===t.name&&(0,v.jsx)("div",{className:"col-12 paymentGatewayBlock",onClick:()=>this.__placeOrder("","RAZORPAY"),children:(0,v.jsx)("div",{className:"block block-link-shadow text-left shadow-light",children:(0,v.jsxs)("div",{className:"block-content block-content-full clearfix py-3 payment-select-block",children:[(0,v.jsx)("div",{className:"float-right mt-10",children:(0,v.jsx)("img",{src:"/assets/img/various/razorpay.png",alt:t.name,className:"img-fluid"})}),(0,v.jsx)("div",{className:"font-size-h3 font-w600",children:localStorage.getItem("checkoutRazorpayText")}),(0,v.jsx)("div",{className:"font-size-sm font-w600 text-muted",children:localStorage.getItem("checkoutRazorpaySubText")})]})})}),"PayStack"===t.name&&(0,v.jsxs)("div",{className:"col-12 mb-4 mt-4 paymentGatewayBlock",children:[(0,v.jsx)("img",{src:"/assets/img/various/paystack.png",alt:t.name,className:"paystack-absolute-logo"}),(0,v.jsx)("usePaystackPayment",{text:localStorage.getItem("paystackPayText"),class:"payButton",callback:this.callback,close:this.close,disabled:!1,embed:!1,reference:this.getReference(),email:this.props.user.data.email,amount:parseInt(parseFloat(100*this.getTotalAfterCalculation())),paystackkey:localStorage.getItem("paystackPublicKey"),tag:"button",currency:localStorage.getItem("currencyId")})]}),"Paypal"===t.name&&(0,v.jsx)("div",{className:"col-12 paymentGatewayBlock",children:(0,v.jsx)(i(),{env:localStorage.getItem("paypalEnv"),client:e,currency:localStorage.getItem("currencyId"),total:parseFloat(this.getTotalAfterCalculation()),shipping:1,onError:this.onError,onSuccess:this.onSuccess,onCancel:this.onCancel,style:{size:"responsive",color:"silver",shape:"rect"}})}),"MercadoPago"===t.name&&(0,v.jsx)("div",{className:"col-12 paymentGatewayBlock",onClick:()=>this.__placeOrder("","MERCADOPAGO"),children:(0,v.jsx)("div",{className:"block block-link-shadow text-left shadow-light",children:(0,v.jsxs)("div",{className:"block-content block-content-full clearfix py-3 payment-select-block",children:[(0,v.jsx)("div",{className:"float-right mt-10",children:(0,v.jsx)("img",{src:"/assets/img/various/mercadopago.png",alt:t.name,className:"img-fluid"})}),(0,v.jsx)("div",{className:"font-size-h3 font-w600",children:localStorage.getItem("checkoutMercadoPagoText")}),(0,v.jsx)("div",{className:"font-size-sm font-w600 text-muted",children:localStorage.getItem("checkoutMercadoPagoSubText")})]})})}),"PayMongo"===t.name&&(this.state.showPaymongoForm?(0,v.jsx)("div",{className:"col-12 paymentGatewayBlock",children:(0,v.jsx)("div",{className:"block block-link-shadow text-left shadow-light",children:(0,v.jsx)("div",{className:"block-content block-content-full clearfix py-3 payment-select-block",children:(0,v.jsxs)("form",{onSubmit:this.handlePaymongo,children:[(0,v.jsx)(W.R1,{children:e=>{let{meta:t,getCardNumberProps:a,getExpiryDateProps:o,getCVCProps:l}=e;return(0,v.jsxs)(s.Fragment,{children:[(0,v.jsx)("div",{className:"font-size-h4 font-w600 mb-2",children:localStorage.getItem("checkoutPayMongoText")}),(0,v.jsx)("input",{className:"form-control edit-address-input",...a({onChange:this.handleInput}),name:"paymongoCCNumber",value:this.state.paymongoCCNumber,placeholder:localStorage.getItem("checkoutCardNumber")}),(0,v.jsx)("input",{className:"form-control edit-address-input",...o({onChange:this.handleInput}),name:"paymongoCCExp",value:this.state.paymongoCCExp,placeholder:localStorage.getItem("checkoutCardExpiration")}),(0,v.jsx)("input",{className:"form-control edit-address-input",...l({onChange:this.handleInput}),value:this.state.paymongoCCCvv,name:"paymongoCCCvv",placeholder:localStorage.getItem("checkoutCardCvv")}),t.isTouched&&t.error&&(0,v.jsxs)("span",{children:["Error: ",t.error]})]})}}),(0,v.jsx)("div",{className:"mt-20 px-15 pt-15 button-block",children:(0,v.jsxs)("button",{type:"submit",className:"btn btn-main",style:{backgroundColor:localStorage.getItem("storeColor")},children:[localStorage.getItem("checkoutPayText")," ","left"===localStorage.getItem("currencySymbolAlign")&&localStorage.getItem("currencyFormat"),this.getTotalAfterCalculation(),"right"===localStorage.getItem("currencySymbolAlign")&&localStorage.getItem("currencyFormat")]})})]})})})}):(0,v.jsx)("div",{className:"col-12 paymentGatewayBlock",onClick:()=>this.__showPaymongoForm(),children:(0,v.jsx)("div",{className:"block block-link-shadow text-left shadow-light",children:(0,v.jsxs)("div",{className:"block-content block-content-full clearfix py-3 payment-select-block",children:[(0,v.jsx)("div",{className:"float-right mt-10",children:(0,v.jsx)("img",{src:"/assets/img/various/paymongo.png",alt:t.name,className:"img-fluid"})}),(0,v.jsx)("div",{className:"font-size-h3 font-w600",children:localStorage.getItem("checkoutPayMongoText")}),(0,v.jsx)("div",{className:"font-size-sm font-w600 text-muted",children:localStorage.getItem("checkoutPayMongoSubText")})]})})}))]},t.id)))]})})}),(0,v.jsx)("div",{className:"progress push m-0 progress-transparent",style:{height:"8px"},children:(0,v.jsx)("div",{className:"progress-bar progress-bar-striped progress-bar-animated hidden",role:"progressbar",id:"progressBar",style:{backgroundColor:localStorage.getItem("storeColor"),width:"10%"}})}),(0,v.jsx)("div",{className:"mb-0 px-15",id:"checkoutMessageOnIdle",children:"<p><br></p>"!==localStorage.getItem("checkoutMessageOnIdle")&&"null"!==localStorage.getItem("checkoutMessageOnIdle")&&""!==localStorage.getItem("checkoutMessageOnIdle")&&(0,v.jsx)("div",{dangerouslySetInnerHTML:{__html:localStorage.getItem("checkoutMessageOnIdle")}})}),(0,v.jsx)("p",{id:"checkoutMessageOnProcess",className:"checkout-message-on-process mb-0 mt-15 text-center hidden",children:localStorage.getItem("checkoutMessageOnProcess")})]})}}K.contextTypes={router:()=>null};const $=(0,h.Ng)((e=>({user:e.user.user,addresses:e.addresses.addresses,cartProducts:e.cart.products,cartTotal:e.total.data,coupon:e.coupon.coupon,checkout:e.checkout.checkout,restaurant_info:e.items.restaurant_info})),{placeOrder:g.w,updateUserInfo:p.bu,getRestaurantInfoById:S.OU})(K);var U=a(6088),V=a(871);var Y=a(7239),q=a(5136);class H extends s.Component{constructor(){super(...arguments),this.state={loading:!1,process_distance_calc_loading:!1,continueFetchPaymentGateway:!0,gateways_received:!1,toPay:""},this.handleLoading=e=>{this.setState({loading:e})},this.fetchPaymentGateways=e=>{this.state.continueFetchPaymentGateway?(console.log("fetching again..."),this.props.getPaymentGateways(e,localStorage.getItem("activeRestaurant")).then((e=>{e&&e.payload&&this.setState({continueFetchPaymentGateway:!1,gateways_received:!0})}))):clearInterval(this.retryPaymentGatewaySetInterval)},this.handleProcessDistanceCalcLoading=e=>{this.setState({process_distance_calc_loading:e})},this.handleToPayText=e=>{setTimeout((()=>{this.setState({toPay:e})}),200)}}componentDidMount(){const{user:e}=this.props;e&&this.props.getPaymentGateways(e.data.auth_token,localStorage.getItem("activeRestaurant")).then((t=>{t&&t.payload?this.setState({gateways_received:!0}):(console.error("fetching payment gateways failed... trying again after 2.5s"),this.retryPaymentGatewaySetInterval=setInterval((()=>{this.fetchPaymentGateways(e.data.auth_token)}),2500))})),this.props.cartProducts.length&&document.getElementsByTagName("body")[0].classList.add("bg-grey-light")}componentWillUnmount(){document.getElementsByTagName("body")[0].classList.remove("bg-grey-light"),clearInterval(this.retryPaymentGatewaySetInterval)}render(){return this.props.cartProducts.length,window.innerWidth>768?(0,v.jsx)(B.C5,{to:"/"}):this.props.confirmCart?null===localStorage.getItem("storeColor")?(0,v.jsx)(B.C5,{to:"/"}):(0,v.jsxs)(s.Fragment,{children:[this.state.loading&&(0,v.jsx)(q.A,{}),this.state.process_distance_calc_loading&&(0,v.jsx)(q.A,{}),(0,v.jsx)(l.A,{seotitle:localStorage.getItem("checkoutPageTitle"),seodescription:localStorage.getItem("seoMetaDescription"),ogtype:"website",ogtitle:localStorage.getItem("seoOgTitle"),ogdescription:localStorage.getItem("seoOgDescription"),ogurl:window.location.href,twittertitle:localStorage.getItem("seoTwitterTitle"),twitterdescription:localStorage.getItem("seoTwitterDescription")}),(0,v.jsx)(o.A,{boxshadow:!0,has_title:!0,title:this.state.toPay,disable_search:!0,from_checkout:!0}),(0,v.jsxs)("div",{className:"pt-50",children:[(0,v.jsx)("div",{className:"pt-30"}),(0,v.jsx)($,{handleProcessDistanceCalcLoading:this.handleProcessDistanceCalcLoading,googleLoadingStatus:this.state.process_distance_calc_loading,paymentgateways:this.props.paymentgateways,gatewayStatus:this.state.gateways_received,handleLoading:this.handleLoading,toPay:this.handleToPayText,google:this.props.google})]})]}):(0,v.jsx)(B.C5,{to:"/cart"})}}const J=(0,Y.GoogleApiWrapper)({apiKey:localStorage.getItem("googleApiKey"),LoadingContainer:q.A})((0,h.Ng)((e=>({total:e.total.total,user:e.user.user,cartProducts:e.cart.products,cartTotal:e.total.data,coupon:e.coupon.coupon,confirmCart:e.confirmCart.confirmCart,paymentgateways:e.paymentgateways.paymentgateways})),{checkConfirmCart:U.v,getPaymentGateways:(e,t)=>a=>x.A.post(d.QW,{token:e,restaurant_id:t}).then((e=>{const t=e.data;return a({type:V.w,payload:t})})).catch((function(e){console.log(e)}))})(H))},5664:(e,t,a)=>{a.d(t,{A:()=>m});var s=a(9950),o=a(1580),l=a.n(o),r=a(413),c=a.n(r),n=a(4414);class i extends s.Component{constructor(){super(...arguments),this.state={shareButton:!1,androidShareButton:!1},this.shareLink=e=>{navigator.share&&navigator.share({url:e.link}).then((()=>console.log("Successful share"))).catch((e=>console.log("Error sharing",e)))},this.shareLinkViaAndroidApp=e=>{"FoodomaaAndroidWebViewUA"===navigator.userAgent&&"undefined"!==window.Android&&window.Android.shareDataThroughIntent(e.link)}}componentDidMount(){navigator.share&&this.setState({shareButton:!0}),"FoodomaaAndroidWebViewUA"===navigator.userAgent&&"undefined"!==window.Android&&this.setState({shareButton:!1,androidShareButton:!0})}render(){return(0,n.jsxs)(s.Fragment,{children:[this.state.shareButton&&(0,n.jsxs)("button",{type:"button",className:"btn search-navs-btns nav-share-btn",style:{position:"relative"},onClick:()=>this.shareLink(this.props),children:[(0,n.jsx)("i",{className:"si si-share"}),(0,n.jsx)(l(),{duration:"500"})]}),this.state.androidShareButton&&(0,n.jsxs)("button",{type:"button",className:"btn search-navs-btns nav-share-btn",style:{position:"relative"},onClick:()=>this.shareLinkViaAndroidApp(this.props),children:[(0,n.jsx)("i",{className:"si si-share"}),(0,n.jsx)(l(),{duration:"500"})]})]})}}const d=i;class h extends s.Component{render(){return(0,n.jsx)(s.Fragment,{children:(0,n.jsx)("div",{className:"col-12 p-0 fixed",style:{zIndex:"9"},children:(0,n.jsx)("div",{className:"block m-0",children:(0,n.jsx)("div",{className:"block-content p-0 ".concat(this.props.dark&&"nav-dark"),children:(0,n.jsxs)("div",{className:"input-group ".concat(this.props.boxshadow&&"search-box"),children:[!this.props.disable_back_button&&(0,n.jsxs)("div",{className:"input-group-prepend",children:[this.props.back_to_home&&(0,n.jsxs)("button",{type:"button",className:"btn search-navs-btns",style:{position:"relative"},onClick:()=>{setTimeout((()=>{this.context.router.history.push("/")}),200)},children:[(0,n.jsx)("i",{className:"si si-arrow-left"}),(0,n.jsx)(l(),{duration:"500"})]}),this.props.goto_orders_page&&(0,n.jsxs)("button",{type:"button",className:"btn search-navs-btns",style:{position:"relative"},onClick:()=>{setTimeout((()=>{this.context.router.history.push("/my-orders")}),200)},children:[(0,n.jsx)("i",{className:"si si-arrow-left"}),(0,n.jsx)(l(),{duration:"500"})]}),this.props.goto_accounts_page&&(0,n.jsxs)("button",{type:"button",className:"btn search-navs-btns",style:{position:"relative"},onClick:()=>{setTimeout((()=>{this.context.router.history.push("/my-account")}),200)},children:[(0,n.jsx)("i",{className:"si si-arrow-left"}),(0,n.jsx)(l(),{duration:"500"})]}),!this.props.back_to_home&&!this.props.goto_orders_page&&!this.props.goto_accounts_page&&(0,n.jsxs)("button",{type:"button",className:"btn search-navs-btns ".concat(this.props.dark&&"nav-dark"),style:{position:"relative"},onClick:()=>{setTimeout((()=>{this.context.router.history.goBack()}),200)},children:[(0,n.jsx)("i",{className:"si si-arrow-left"}),(0,n.jsx)(l(),{duration:"500"})]})]}),(0,n.jsxs)("p",{className:"form-control search-input d-flex align-items-center ".concat(this.props.dark&&"nav-dark"),children:[this.props.logo&&(0,n.jsx)("img",{src:"/assets/img/logos/logo.png",alt:localStorage.getItem("storeName"),width:"120"}),this.props.has_title?(0,n.jsx)(s.Fragment,{children:this.props.from_checkout?(0,n.jsxs)("span",{className:"nav-page-title",id:"checkoutNavPageTitle",children:[localStorage.getItem("cartToPayText")," ",(0,n.jsxs)("span",{style:{color:localStorage.getItem("storeColor")},children:["left"===localStorage.getItem("currencySymbolAlign")&&localStorage.getItem("currencyFormat"),this.props.title,"right"===localStorage.getItem("currencySymbolAlign")&&localStorage.getItem("currencyFormat")]})]}):(0,n.jsx)("span",{className:"nav-page-title",children:this.props.title})}):null,this.props.has_delivery_icon&&(0,n.jsx)(c(),{left:!0,children:(0,n.jsx)("img",{src:"/assets/img/various/delivery-bike.png",alt:this.props.title,className:"nav-page-title"})})]}),this.props.has_restaurant_info?(0,n.jsxs)("div",{className:"fixed-restaurant-info hidden",ref:e=>{this.heading=e},children:[(0,n.jsx)("span",{className:"font-w700 fixedRestaurantName",children:this.props.restaurant.name}),(0,n.jsx)("br",{}),(0,n.jsxs)("span",{className:"font-w400 fixedRestaurantTime",children:[(0,n.jsx)("i",{className:"si si-clock"})," ",this.props.restaurant.delivery_time," ",localStorage.getItem("homePageMinsText")]})]}):null,(0,n.jsxs)("div",{className:"input-group-append",children:[!this.props.disable_search&&(0,n.jsxs)("button",{type:"submit",className:"btn search-navs-btns",style:{position:"relative"},children:[(0,n.jsx)("i",{className:"si si-magnifier"}),(0,n.jsx)(l(),{duration:"500"})]}),this.props.homeButton&&(0,n.jsxs)("button",{type:"button",className:"btn search-navs-btns nav-home-btn",style:{position:"relative"},onClick:()=>{setTimeout((()=>{this.context.router.history.push("/")}),200)},children:[(0,n.jsx)("i",{className:"si si-home"}),(0,n.jsx)(l(),{duration:"500"})]}),this.props.shareButton&&(0,n.jsx)(d,{link:window.location.href})]})]})})})})})}}h.contextTypes={router:()=>null};const m=h},9107:(e,t,a)=>{a.d(t,{g:()=>s});const s=(e,t,a,s)=>{function o(e){return e*Math.PI/180}let l=o(s-t),r=o(a-e),c=Math.sin(l/2)*Math.sin(l/2)+Math.cos(o(t))*Math.cos(o(s))*Math.sin(r/2)*Math.sin(r/2);return 6371*(2*Math.atan2(Math.sqrt(c),Math.sqrt(1-c)))}},2576:(e,t,a)=>{a.d(t,{A:()=>o});var s=a(9107);const o=(e,t,a,o,l,r)=>{const c=[{lat:parseFloat(t),lng:parseFloat(e)}],n=[{lat:parseFloat(o),lng:parseFloat(a)}],i=l.maps.TravelMode.DRIVING;(new l.maps.DistanceMatrixService).getDistanceMatrix({origins:c,destinations:n,travelMode:i},((l,c)=>{if(console.log("RESPONSE",l),console.log("STATUS",l.rows[0].elements[0].status),"OK"===l.rows[0].elements[0].status){let e=(l.rows[0].elements[0].distance.value/1e3).toFixed(1);r(e)}else{console.log("Falling back to basic distance calculation");let l=(0,s.g)(e,t,a,o);r(l)}}))}},756:(e,t,a)=>{a.d(t,{$:()=>s});const s=e=>{if(e){let t=parseFloat(e);return t=t.toFixed(2),t}return 0}},4520:(e,t,a)=>{a.d(t,{w:()=>n});var s=a(5931),o=a(1753),l=a(4122),r=a(8469),c=a(2780);const n=(e,t,a,n,i,d,h,m,g,p,u,y,x,S)=>(f,k)=>r.A.post(o.HD,{token:e.data.auth_token,user:e,order:t,coupon:a,location:n,order_comment:i,total:d,method:h,payment_token:m,delivery_type:g,partial_wallet:p,dis:u,pending_payment:y,tipAmount:x,cash_change_amount:S,schedule_date:null!==localStorage.getItem("orderDate")?JSON.parse(localStorage.getItem("orderDate")):null,schedule_slot:null!==localStorage.getItem("orderSlot")?JSON.parse(localStorage.getItem("orderSlot")):null}).then((e=>{const t=e.data;if(console.log("From Checkout"),!t.success)return t;{f({type:s.D,payload:t});const e=k().cart.products;localStorage.removeItem("orderComment"),localStorage.removeItem("orderSlot"),localStorage.removeItem("orderDate");for(let t=e.length-1;t>=0;t--)e.splice(t,1);f((0,c.i)(e)),localStorage.removeItem("appliedCoupon");const a=[];f({type:l.A,payload:a})}})).catch((function(e){return e.response}))},6088:(e,t,a)=>{a.d(t,{g:()=>c,v:()=>r});var s=a(5048),o=a(1753),l=a(8469);const r=()=>e=>e({type:s.K,payload:!0}),c=e=>t=>l.A.post(o.DM,{items:e}).then((e=>e.data)).catch((function(e){console.log(e)}))},2780:(e,t,a)=>{a.d(t,{i:()=>l});var s=a(9500),o=a(756);const l=e=>t=>{let a={productQuantity:e.reduce(((e,t)=>++e),0),totalPrice:e.reduce(((e,t)=>{let a=0;return t.selectedaddons&&t.selectedaddons.map((e=>(a+=parseFloat(e.price),a))),e+=t.price*t.quantity+a*t.quantity,e=parseFloat(e),(0,o.$)(e),e}),0)};t({type:s.t,payload:a})}}}]);