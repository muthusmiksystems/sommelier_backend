"use strict";(self.webpackChunksommelier=self.webpackChunksommelier||[]).push([[459],{4459:(t,e,o)=>{o.r(e),o.d(e,{GeoLocationPage:()=>A,default:()=>C});var s=o(9950),a=o(8858),r=o(3507),n=o(7239),i=o(2216),l=o(1886),d=o.n(l),c=o(4414);class g extends s.Component{constructor(){super(...arguments),this.state={initialPosition:{lat:37.77,lng:-122.42},zoom:15,isAllowedLocationToDetect:!0,hideErrorMessage:!1,getCurrentAddress:!1,centerAroundCurrentLocation:!1,center:{}},this.onMarkerClick=()=>{navigator.geolocation.getCurrentPosition((t=>{this.setState((e=>({center:{...e.center,lat:t.coords.latitude,lng:t.coords.longitude},centerAroundCurrentLocation:!0}))),this.getCurrentLocation(t.coords.latitude,t.coords.longitude)})),navigator.permissions.query({name:"geolocation"}).then((t=>{console.log(t),"granted"===t.state||"prompt"===t.state?this.handleGPS(!0):"denied"===t.state&&this.handleGPS(!1),t.onchange=t=>{"denied"===t.currentTarget.state&&this.handleGPS(!1),"granted"===t.currentTarget.state&&(this.handleGPS(!0),this.handleMap())}}))},this.handleMap=()=>{this.setState({getCurrentAddress:!0})},this.handleGPS=t=>{this.setState({isAllowedLocationToDetect:t,hideErrorMessage:!0})},this.onDrag=()=>{this.setState({isAllowedLocationToDetect:!0,getCurrentAddress:!1})},this.getCurrentLocation=(t,e)=>{this.props.reverseLookup(t,e)}}componentDidMount(){if(console.log(this.props),null!==localStorage.getItem("geoLocation")){const t=JSON.parse(localStorage.getItem("geoLocation")).geometry.location;this.setState({initialPosition:{lat:t.lat,lng:t.lng}})}setTimeout((()=>{this.setState({zoom:18})}),1e3)}render(){return(0,c.jsx)(s.Fragment,{children:(0,c.jsxs)("div",{children:[(0,c.jsxs)(n.Map,{google:this.props.google,style:{width:"100%",height:"55vh"},initialCenter:{lat:JSON.parse(localStorage.getItem("geoLocation")).geometry.location.lat,lng:JSON.parse(localStorage.getItem("geoLocation")).geometry.location.lng},onDragend:(t,e,o)=>this.props.onMarkerDragEnd(e),zoom:this.state.zoom,styles:i,zoomControl:!1,mapTypeControl:!1,scaleControl:!0,streetViewControl:!1,fullscreenControl:!1,onReady:(t,e)=>{this.props.dragging?this.props.reverseLookup(this.state.initialPosition.lat,this.state.initialPosition.lng):this.props.location(this.state.initialPosition.lat,this.state.initialPosition.lng),localStorage.setItem("userLat",e.center.lat()),localStorage.setItem("userLng",e.center.lng())},onDragstart:()=>{this.props.handleDragging(!0),this.setState({isAllowedLocationToDetect:!0}),this.onDrag()},centerAroundCurrentLocation:this.state.centerAroundCurrentLocation,center:this.state.center,children:[(0,c.jsx)("div",{onClick:this.onMarkerClick,children:(0,c.jsxs)("div",{className:"current-location-btn-overmap",children:[(0,c.jsx)("i",{className:"si si-compass"})," ",localStorage.getItem("useCurrentLocationText")]})}),!this.state.isAllowedLocationToDetect&&(0,c.jsx)("div",{className:"auth-error",children:(0,c.jsx)("div",{className:"error-shake",children:localStorage.getItem("gpsAccessNotGrantedMsg")})})]}),(0,c.jsx)("div",{className:"center-marker-pulse",children:(0,c.jsx)(d(),{top:!0,duration:1e3,children:(0,c.jsx)("img",{src:"/assets/img/various/dragable-markerv2.png",alt:"Marker",className:"center-marker"})})})]})})}}const h=(0,n.GoogleApiWrapper)({apiKey:localStorage.getItem("googleApiKey"),LoadingContainer:()=>(0,c.jsx)(a.Ay,{height:400,width:window.innerWidth,speed:1.2,primaryColor:"#f3f3f3",secondaryColor:"#ecebeb",children:(0,c.jsx)("rect",{x:"0",y:"0",rx:"0",ry:"0",width:window.innerWidth,height:"400"})})})(g);var u=o(1580),p=o.n(u),m=o(8341),x=o(8974),f=o(8429),v=o(2515),y=o(1753),S=o(8469),b=o(72),w=o.n(b),j=o(5136),L=o(9351);class A extends s.Component{constructor(){super(),this.state={location:"",dragging:!1,house:null,tag:null,error:!1,loading:!1},this.handleAddressInput=t=>{const{name:e,value:o}=t.target;this.setState({[e]:o})},this.reverseLookup=(t,e)=>{S.A.post(y.J8,{lat:t,lng:e}).then((t=>{this.setState({location:t.data,dragging:!1})})).catch((function(t){alert(t.response.data),console.warn(t.response.data)}))},this.onMarkerDragEnd=t=>{console.log(t),console.log({lat:t.center.lat(),lng:t.center.lng()}),localStorage.setItem("userLat",t.center.lat()),localStorage.setItem("userLng",t.center.lng()),this.reverseLookup(t.center.lat(),t.center.lng())},this.handleDragging=()=>{this.setState({dragging:!0}),this.refs.confirmGpsLocation.style.height="44.7vh"},this.handleSaveNewAddress=()=>{const{user:t}=this.props;"true"===localStorage.getItem("flatApartmentAddressRequired")?this.validator.fieldValid("house")?this.__saveAddressToLS(t):(console.log("validation failed"),this.validator.showMessages()):this.__saveAddressToLS(t)},this.__saveAddressToLS=t=>{if(t.success)this.setState({loading:!0}),console.log("Save loggedin user address"),this.props.saveAddress(t.data.id,t.data.auth_token,localStorage.getItem("userLat"),localStorage.getItem("userLng"),this.state.location,this.state.house,this.state.tag,"get_only_default_address");else{const t={lat:localStorage.getItem("userLat"),lng:localStorage.getItem("userLng"),address:this.state.location,house:this.state.house,tag:this.state.tag};new Promise((e=>{localStorage.setItem("userSetAddress",JSON.stringify(t)),e("Address Saved")})).then((()=>{"1"===localStorage.getItem("fromCart")?(localStorage.removeItem("fromCart"),this.context.router.history.push("/cart")):(this.props.clearRestaurantList(),this.context.router.history.push("/"))}))}},this.inputFocus=()=>{this.refs.confirmGpsLocation.style.height="60vh"},this.handleClickOutside=t=>{this.refs.confirmGpsLocation&&!this.refs.confirmGpsLocation.contains(t.target)&&(this.refs.confirmGpsLocation.style.height="44.7vh")},this.getLocation=()=>{this.setState({location:JSON.parse(localStorage.getItem("geoLocation")).formatted_address})},this.validator=new(w())({autoForceUpdate:this,messages:{required:localStorage.getItem("fieldValidationMsg")}})}componentDidMount(){document.addEventListener("mousedown",this.handleClickOutside)}componentWillReceiveProps(t){if(console.log(t.addresses),this.props.address!==t.addresses){console.log("Address saved");const e={lat:t.addresses.latitude,lng:t.addresses.longitude,address:t.addresses.address,house:t.addresses.house,tag:t.addresses.tag};new Promise((t=>{localStorage.setItem("userSetAddress",JSON.stringify(e)),t("Address Saved")})).then((()=>{"1"===localStorage.getItem("fromCart")?(localStorage.removeItem("fromCart"),this.context.router.history.push("/cart")):(this.props.clearRestaurantList(),this.context.router.history.push("/"))}))}}componentWillUnmount(){document.removeEventListener("mousedown",this.handleClickOutside)}render(){return window.innerWidth>768||null===localStorage.getItem("storeColor")?(0,c.jsx)(f.C5,{to:"/"}):(0,c.jsxs)("div",{children:[console.log(localStorage.getItem("isAllowed")),(0,c.jsx)(v.A,{seotitle:localStorage.getItem("seoMetaTitle"),seodescription:localStorage.getItem("seoMetaDescription"),ogtype:"website",ogtitle:localStorage.getItem("seoOgTitle"),ogdescription:localStorage.getItem("seoOgDescription"),ogurl:window.location.href,twittertitle:localStorage.getItem("seoTwitterTitle"),twitterdescription:localStorage.getItem("seoTwitterDescription")}),this.state.loading&&(0,c.jsx)(j.A,{}),(0,c.jsx)(h,{reverseLookup:this.reverseLookup,onMarkerDragEnd:this.onMarkerDragEnd,handleDragging:this.handleDragging,dragging:this.state.dragging,location:this.getLocation}),(0,c.jsxs)("button",{type:"button",className:"btn search-navs-btns",style:{position:"relative",borderRadius:"0 50px 50px 0",boxShadow:"0 2px 8px 1px #E0E0E0"},onClick:this.context.router.history.goBack,children:[(0,c.jsx)("i",{className:"si si-arrow-left"}),(0,c.jsx)(p(),{duration:"500"})]}),(0,c.jsx)("div",{className:"confirm-gps-location",ref:"confirmGpsLocation",onClick:this.inputFocus,children:this.state.dragging?(0,c.jsxs)(a.Ay,{height:345,width:window.innerWidth,speed:1.2,primaryColor:"#f3f3f3",secondaryColor:"#ecebeb",children:[(0,c.jsx)("rect",{x:"20",y:"15",rx:"0",ry:"0",width:"110",height:"16"}),(0,c.jsx)("rect",{x:"20",y:"45",rx:"0",ry:"0",width:"280",height:"20"}),(0,c.jsx)("rect",{x:"315",y:"45",rx:"0",ry:"0",width:"70",height:"20"}),(0,c.jsx)("rect",{x:"20",y:"100",rx:"0",ry:"0",width:"110",height:"16"}),(0,c.jsx)("rect",{x:"20",y:"130",rx:"0",ry:"0",width:"280",height:"20"}),(0,c.jsx)("rect",{x:"20",y:"180",rx:"0",ry:"0",width:"110",height:"16"}),(0,c.jsx)("rect",{x:"20",y:"210",rx:"0",ry:"0",width:"280",height:"20"}),(0,c.jsx)("rect",{x:"0",y:"280",rx:"0",ry:"0",width:window.innerWidth,height:"60"})]}):(0,c.jsx)(s.Fragment,{children:(0,c.jsxs)("div",{className:"p-15",children:[(0,c.jsx)("p",{className:"mb-0 font-w600 text-muted",children:localStorage.getItem("yourLocationText")}),(0,c.jsxs)("div",{className:"d-flex align-items-baseline",children:[(0,c.jsx)("p",{className:"truncate-text mb-0",style:{minWidth:"84%",fontWeight:"500"},children:this.state.location}),(0,c.jsxs)(r.A,{to:"/search-location",delay:400,className:"change-address-text m-0 p-5 pull-right",style:{color:localStorage.getItem("storeColor"),position:"relative"},children:[localStorage.getItem("cartChangeLocation"),(0,c.jsx)(p(),{duration:400})]})]}),(0,c.jsx)("hr",{}),(0,c.jsxs)("div",{className:"form-group m-0",children:[(0,c.jsxs)("label",{className:"col-12 edit-address-input-label p-0",children:[localStorage.getItem("editAddressAddress"),"true"===localStorage.getItem("flatApartmentAddressRequired")&&this.validator.message("house",this.state.house,"required")]}),(0,c.jsx)("div",{className:"col-md-9 p-0",children:(0,c.jsx)("input",{type:"text",name:"house",onChange:this.handleAddressInput,className:"form-control edit-address-input mb-2",value:this.state.house})}),(0,c.jsxs)("div",{class:"address-tags-block",children:[(0,c.jsx)("label",{className:"col-12 edit-address-input-label p-0",children:localStorage.getItem("editAddressTag")}),(0,c.jsx)("div",{className:"col-md-9 p-0",children:(0,c.jsx)("input",{type:"text",name:"tag",onChange:this.handleAddressInput,className:"form-control edit-address-input edit-address-tag mb-2",placeholder:localStorage.getItem("addressTagPlaceholder"),value:this.state.tag})})]})]})]})})}),!this.state.dragging&&(0,c.jsxs)("button",{type:"button",className:"btn-save-address",onClick:this.handleSaveNewAddress,style:{backgroundColor:localStorage.getItem("storeColor"),position:"fixed",bottom:"0"},children:[localStorage.getItem("buttonSaveAddress"),(0,c.jsx)(p(),{duration:200})]})]})}}A.contextTypes={router:()=>null};const C=(0,m.Ng)((t=>({user:t.user.user,addresses:t.addresses.addresses})),{saveAddress:x.Ex,clearRestaurantList:L.Bg})(A)},8974:(t,e,o)=>{o.d(e,{Ex:()=>i,ab:()=>l,tS:()=>n,y_:()=>d});var s=o(8262),a=o(1753),r=o(8469);const n=(t,e,o)=>n=>{r.A.post(a.ss,{user_id:t,token:e,restaurant_id:o}).then((t=>{const e=t.data;return n({type:s.oz,payload:e})})).catch((function(t){console.log(t)}))},i=(t,e,o,n,i,l,d,c)=>g=>{r.A.post(a.RA,{token:e,user_id:t,latitude:o,longitude:n,address:i,house:l,tag:d,get_only_default_address:c}).then((t=>{const e=t.data;return g({type:s.b8,payload:e})})).catch((function(t){console.log(t)}))},l=(t,e,o)=>n=>{r.A.post(a.pP,{token:o,user_id:t,address_id:e}).then((t=>{const e=t.data;return n({type:s.fJ,payload:e})})).catch((function(t){console.log(t)}))},d=(t,e,o)=>n=>r.A.post(a.tv,{token:o,user_id:t,address_id:e}).then((t=>{const e=t.data;return n({type:s.Zm,payload:e})})).catch((function(t){console.log(t)}))},1886:(t,e,o)=>{function s(t,e){var o=e.left,s=e.right,a=e.up,r=e.down,n=e.top,i=e.bottom,l=e.mirror,c=e.opposite,h=(o?1:0)|(s?2:0)|(n||r?4:0)|(i||a?8:0)|(l?16:0)|(c?32:0)|(t?64:0);if(g.hasOwnProperty(h))return g[h];if(!l!=!(t&&c)){var u=[s,o,i,n,r,a];o=u[0],s=u[1],n=u[2],i=u[3],a=u[4],r=u[5]}var p,m=o||s,x=n||i||a||r,f=void 0,v=void 0,y=void 0,S=void 0,b=void 0,w=void 0,j=void 0,L=void 0,A=void 0,C=void 0,I=void 0,k=void 0,N=void 0;return t?(y=m?(s?"-":"")+"20px":0,S=x?(a||i?"":"-")+"10px":"0",b=(r||n?"":"-")+"20px",k=m?(o?"-":"")+"2000px":"0",N=x?(r||n?"-":"")+"2000px":"0"):(f=m?(o?"-":"")+"3000px":"0",v=x?(r||n?"-":"")+"3000px":"0",w=m?(s?"-":"")+"25px":"0",j=x?(a||i?"-":"")+"25px":"0",L=m?(o?"-":"")+"10px":"0",A=x?(r||n?"-":"")+"10px":"0",C=m?(s?"-":"")+"5px":"0",I=x?(a||i?"-":"")+"5px":"0"),p=m||x?t?"\n        20% {\n          transform: translate3d("+y+", "+S+", 0);\n          }\n        "+(x?"40%, 45% {\n            opacity: 1;\n            transform: translate3d(0, "+b+", 0);\n          }":"")+"\n          to {\n            opacity: 0;\n            transform: translate3d("+k+", "+N+", 0);\n        }\n      ":"from, 60%, 75%, 90%, to {\n        animation-timing-function: cubic-bezier(0.215, 0.610, 0.355, 1.000);\n      }\n      from {\n        opacity: 0;\n        transform: translate3d("+f+", "+v+", 0);\n      }\n      60% {\n        opacity: 1;\n        transform: translate3d("+w+", "+j+", 0);\n      }\n      75% {\n        transform: translate3d("+L+", "+A+", 0);\n      }\n      90% {\n        transform: translate3d("+C+", "+I+", 0);\n      }\n      to {\n        transform: none;\n      }":t?"20% {\n          transform: scale3d(.9, .9, .9);\n        }\n        50%, 55% {\n          opacity: 1;\n          transform: scale3d(1.1, 1.1, 1.1);\n        }\n        to {\n          opacity: 0;\n          transform: scale3d(.3, .3, .3);\n      }":"from, 20%, 40%, 60%, 80%, to {\n        animation-timing-function: cubic-bezier(0.215, 0.610, 0.355, 1.000);\n      }\n      0% {\n        opacity: 0;\n        transform: scale3d(.3, .3, .3);\n      }\n      20% {\n        transform: scale3d(1.1, 1.1, 1.1);\n      }\n      40% {\n        transform: scale3d(.9, .9, .9);\n      }\n      60% {\n        opacity: 1;\n        transform: scale3d(1.03, 1.03, 1.03);\n      }\n      80% {\n        transform: scale3d(.97, .97, .97);\n      }\n      to {\n        opacity: 1;\n        transform: scale3d(1, 1, 1);\n      }",g[h]=(0,d.animation)(p),g[h]}function a(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:d.defaults,e=t.children,o=(t.out,t.forever),a=t.timeout,r=t.duration,n=void 0===r?d.defaults.duration:r,i=t.delay,c=void 0===i?d.defaults.delay:i,g=t.count,h=void 0===g?d.defaults.count:g,u=function(t,e){var o={};for(var s in t)e.indexOf(s)>=0||Object.prototype.hasOwnProperty.call(t,s)&&(o[s]=t[s]);return o}(t,["children","out","forever","timeout","duration","delay","count"]),p={make:s,duration:void 0===a?n:a,delay:c,forever:o,count:h,style:{animationFillMode:"both"},reverse:u.left};return(0,l.default)(u,p,p,e)}Object.defineProperty(e,"__esModule",{value:!0});var r,n=o(1942),i=o(7374),l=(r=i)&&r.__esModule?r:{default:r},d=o(7244),c={out:n.bool,left:n.bool,right:n.bool,top:n.bool,bottom:n.bool,mirror:n.bool,opposite:n.bool,duration:n.number,timeout:n.number,delay:n.number,count:n.number,forever:n.bool},g={};a.propTypes=c,e.default=a,t.exports=e.default},2216:t=>{t.exports=JSON.parse('[{"featureType":"poi.business","stylers":[{"visibility":"off"}]},{"featureType":"poi.park","elementType":"labels.text","stylers":[{"visibility":"off"}]}]')}}]);